@page "/AdminInterface"
@attribute [RenderModeInteractiveServer]
@inject NavigationManager NavigationManager

<PageTitle>AdminInterface</PageTitle>
<h1>staff</h1>
<!--if statmens that chech if admin is logged in, option to log out if thats true-->
@if(SessionDetails.IsLoggedIn == true)
{
    //a admin interface menu 
    switch (Mode)
    {   
        
        case 0:
        <div>
            <button class="btn btn-primary" @onclick="() => AdmineChoice(1)">Add or remove a room</button>
            
            <button class="btn btn-primary" @onclick="() => AdmineChoice(2)">Check-in guest</button>
            
            <button class="btn btn-primary" @onclick="() => AdmineChoice(3)">Check-out guest</button>
            
            <button class="btn btn-primary" @onclick="() => AdmineChoice(4)">Check room availability</button>
        </div>    
        break;

        case 1:
        //add and remove room options for admin
        switch (IntAddRemove)
        {
            case 0:
            <p>Do you want to add or remove a room?</p>
            <div>
            <button class="btn btn-primary" @onclick="() => AddRemove(1)">Add</button>
            <button class="btn btn-primary" @onclick="() => AddRemove(2)">Remove</button>
            </div>
            <button class="btn btn-primary" @onclick="() => AdmineChoice(0)">Back</button>
            break;

            case 1:
            //an editform that specifies the room details for that is to be added
            <EditForm Model="@Model" OnSubmit="@Submit">
            <p>Room number  <InputText @bind-Value="Model!.RoomNr" /></p>
            <p>Description  <InputText @bind-Value="Model.Description" /></p>
            <p>Room price  <InputNumber @bind-Value="Model.RoomPrice" /></p>
            <p>Max capacity  <InputNumber @bind-Value="Model.Capacity" /></p> 
            <p>Floor number  <InputNumber @bind-Value="Model.FloorNr" /></p>       
            <button type="submit">Submit</button> 
            <button class="btn btn-primary" @onclick="() => AddRemove(0)">Back</button>
            </EditForm>
            
            break;

            
            case 2:
            //an if statmnet that list rooms available to be removed
            if(Hotel.Rooms.Count == 0)
            {
                <p>No rooms available to remove in the hotel</p>
            }
            for(int i = 0; i < Hotel.Rooms.Count; i++)
            {
                Count count = new Count();
                count.room = Hotel.Rooms[i];
                <p>@((MarkupString)Hotel.Rooms[i].ToString())</p>
                <button class="btn btn-primary" @onclick="() => RemoveRoom(count.room)">Remove</button>
            }
            <button class="btn btn-primary" @onclick="() => AddRemove(0)">Back</button>
            break;
        }
        break;
        
        case 2:
            //a for loop that list existing rooms that have not yet been checked in
            for(int i = 0; i < Hotel.Rooms.Count; i++)
                {
                    if(Hotel.Rooms[i].roomBookings.Count > 0 &&
                       Hotel.Rooms[i].roomBookings.Exists(x => x.IsChecked.Equals(false)))
                    {
                        
                        <h1>@Hotel.Rooms[i].RoomNr @Hotel.Rooms[i].Description</h1>
                        int x = 0;
                        
                        //a forech loop that list every booking for that room that has not been checked in
                        foreach(Booking b in Hotel.Rooms[i].roomBookings)
                        {
                            if(b.IsChecked == false)
                            {
                                Count c  = new Count();
                                c.booking = b;
                                <p>@b.Guest!.Name <br /> @b.BookingPeriod</p>
                                <button class="btn btn-primary" @onclick="() => CheckIn(c.booking)">Check in</button>
                                x++;
                            }
                        }
                    }
                }
            <button class="btn btn-primary" @onclick="() => AdmineChoice(0)">Back</button>
           
        break;
        
        case 3:
            if(CurrentlyCheckedIn())
            {
                <h1>Currently checked in guests</h1>
            }
            else
            {
                <h2>No guest currently checked in</h2>
            }
            
            
            //for loops that list available rooms to check out
            for(int i = 0; i < Hotel.Rooms.Count; i++)
            {

                if(Hotel.Rooms[i].roomBookings.Exists(x => x.IsChecked.Equals(true)))
                {
                    //foreach loop that list checked in bookings
                    foreach(Booking b in Hotel.Rooms[i].roomBookings)
                        {
                            if(b.IsChecked == true)
                            {
                                Count c = new Count();
                                c.room = Hotel.Rooms[i];
                                c.booking = b;
                                <p>@b.Guest!.Name <br /> @((MarkupString)b.ToString())</p>
                                <button class="btn btn-primary" @onclick="() => CheckOut(c.room, c.booking)">Check Out</button>

                                
                            }
                        }
                }
            }<button class="btn btn-primary" @onclick="() => AdmineChoice(0)">Back</button>
        break;
        
        case 4:
            //a foreach loop that list all rooms at the hotel and theis current status
            foreach(Room r in Hotel.Rooms)
            {
                string body = r.ToString();
                if(r.roomBookings.Exists(x => x.IsChecked == true))
                {
                    body += "<br /><b>Status:</b> Unavailable";
                }
                else
                {
                    body += "<br /><b>Status:</b> Available";
                }
                <p>
                @((MarkupString)body)
                </p>
            }
            <button class="btn btn-primary" @onclick="() => AdmineChoice(0)">Back</button>
            break;
    }
<p>@ErrorMsg</p>
} 
else
{
    <p>Need to be logged in to access Admin functions</p>
    <button class="btn btn-primary" @onclick="() => LogOut()">Main menu</button>
}



@code
{
    protected override void OnInitialized() => Model ??= new();
    private string ErrorMsg = "";
    private Room? Model {get; set;}
    private int IntAddRemove = 0;
    private int Mode = 0;

    class Count
    {
        public Room? room; 
        public Booking? booking;

        public int c;
    }

    //a log ou method, navigates back to home when logges out
    void LogOut()
    {
        SessionDetails.IsLoggedIn = false;
        NavigationManager.NavigateTo("");
    }

    //a method that controlls the admin menu and restets details
    void AdmineChoice(int i)
    {
        Mode = i;
        ErrorMsg = "";

    }

    //a method that controlls the addremove room admin menu
    void AddRemove(int i)
    {
        IntAddRemove = i;
        ErrorMsg = "";
    }

    //a method that controlls removeroom
    void RemoveRoom(Room r)
    {
        Hotel.RemoveRoom(r);
    }

    //a methodthat checks in a specific booking
    void CheckIn(Booking b)
    {
        Hotel.CheckIn(b);
        ErrorMsg = $"has been check-in succesfully";
    }

    //a method that checksout a specific booking
    void CheckOut(Room r ,Booking b)
    {
        Hotel.CheckOut(b, r);
        ErrorMsg =$"Check-out succesfull";
    }

    //a method that checks that all feilds are filled in and add if thats the case
    private void Submit()
    {
        Room room = new Room(Model!.RoomNr!, Model.Description!, Model.RoomPrice, Model.Capacity, Model.FloorNr);

        if(Model.RoomNr != null && Model.Description != null && Model.RoomPrice != 0 && 
           Model.Capacity !=0 && Model.FloorNr != 0)
        {
            Hotel.AddRoom(room, out string outputMessage);
            ErrorMsg = outputMessage;
        }
        else
        {
            ErrorMsg = "Error, all fields must be filled in";
        }
    }

    bool CurrentlyCheckedIn()
    {
        foreach(Room r in Hotel.Rooms)
        {
            if(r.roomBookings.Exists(x => x.IsChecked.Equals(true)))
            {
                return true;
            }

        }
        return false;

    }
    
}